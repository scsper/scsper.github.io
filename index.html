<html>

<head>
  <style>
    .header {
      height: 50px;
      background-color: navy;
      width: 100%;
    }

    .header-title {
      color: white;
      margin: 0;
      font-family: sans-serif;
    }

    .gain {
      color: green;
    }

    .loss {
      color: red;
    }
  </style>

  <script>
    const SATOSHI = 'satoshi'
    const BITCOIN = 'bitcoin'
    const GAIN = 'gain'
    const SELL = 'sell'

    let feePercent = .001
    let unit = SATOSHI
    let mode = SELL

    function getFee(salePrice, numShares, feePercent) {
      return salePrice * numShares * feePercent;
    }

    function setFee(fee) {
      feePercent = parseFloat(fee, 10) / 100
    }

    function calculateSell(e) {
      const numShares = 1;
      const salePrice = parseFloat(e.target.value) || 0;

      const gain = salePrice * numShares - getFee(salePrice, numShares, feePercent);

      const percentages = [-0.1, -0.05, -0.03, -0.02, -0.01, -0.002, 0, 0.01, 0.02, 0.03, 0.04, 0.05, 0.1];

      return percentages.map(ROI => {
        const cost = gain / (ROI + 1);
        const buyPrice = cost / (numShares * (1 + feePercent));
        let word;

        if (ROI >= 0) {
          word = 'gain';
        } else {
          word = 'loss';
        }

        return {
          buyPrice,
          ROI
        }
      });
    }

    function updateSaleCalculatorResults(e) {
      const saleCalculatorResults = calculateSell(e)
      const resultsHtml = saleCalculatorResults.map(result => {
        let className = ''

        if (result.ROI >= 0) {
          className = 'gain'
        } else {
          className = 'loss'
        }
        const prettyROI = Math.abs(result.ROI) * 100
        const prettyBuyPrice = unit === BITCOIN ? result.buyPrice.toString().slice(0, 10) : Math.round(result.buyPrice)

        return `<tr><td class=${className}>${prettyROI}%</td><td>${prettyBuyPrice}</td></tr>`
      }).join('')

      const innerHTML = `<table>${resultsHtml}</table>`

      document.querySelector('.calculator-results-container').innerHTML = innerHTML
    }

    function updateCalculatorInput() {
      let value = document.getElementById('calculator-input').value
      if (unit === BITCOIN) {
        value *= .00000001
      } else {
        value /= .00000001
      }

      document.getElementById('calculator-input').value = value

      return value
    }
  </script>
</head>

<body>
  <div class="header">
    <h1 class="header-title">Crypto ROI Calculator</h1>
  </div>

  <form class="unit-form">
    <label>Bitcoin</label>
    <input id="bitcoin" name="unit" type="radio" />
    <label>Satoshis</label>
    <input id="satoshi" name="unit" type="radio" checked />
  </form>

  <form class="mode-form">
    <label>Gain</label>
    <input id="gain-mode" name="mode" type="radio" />
    <label>Sell</label>
    <input id="sell-mode" name="mode" type="radio" checked />
  </form>

  <div class="container">
    <div class="calculator-container">
      <form id="calculator">
        <div>
          <label>Sale price</label>
          <input id="calculator-input" />
        </div>
        <div>
          <label>Fee Percentage</label>
          <input id="calculator-fee-input" />
        </div>
      </form>

      <div class="calculator-results-container">
      </div>
    </div>
  </div>
</body>

<script>
    function initializeMode() {
      if (mode === SELL) {
        document.getElementById('calculator-fee-input').value = feePercent * 100
        document.getElementById('calculator-input').onkeyup = updateSaleCalculatorResults
        document.getElementById('calculator-fee-input').onkeyup = setFee

        const unitNodes = document.querySelectorAll('.unit-form input[type=radio]')

        unitNodes.forEach(unitNode => {
          unitNode.onclick = function (e) {
            if (unitNode.id === BITCOIN) {
              unit = BITCOIN
            } else {
              unit = SATOSHI
            }

            const value = updateCalculatorInput()
            updateSaleCalculatorResults({
              target: {
                value
              }
            })
          }
        })
      }
    }

    initializeMode()
</script>

</html>
